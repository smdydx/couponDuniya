[Unit]
Description=CouponAli Email/SMS Queue Worker
After=network.target redis.service postgresql.service
Wants=redis.service postgresql.service

[Service]
Type=simple
User=appuser
Group=appuser
WorkingDirectory=/app/backend
Environment="PYTHONPATH=/app/backend"
Environment="REDIS_URL=redis://localhost:6379"
Environment="DATABASE_URL=postgresql://user:password@localhost/couponali"
EnvironmentFile=/app/backend/.env

# Run the worker
ExecStart=/usr/bin/python3 -m workers.email_sms_worker

# Restart policy
Restart=always
RestartSec=10
StartLimitInterval=5min
StartLimitBurst=3

# Resource limits
MemoryLimit=512M
CPUQuota=100%

# Logging
StandardOutput=journal
StandardError=journal
SyslogIdentifier=couponali-worker

# Security
NoNewPrivileges=true
PrivateTmp=true
ProtectSystem=strict
ProtectHome=true
ReadWritePaths=/app/backend/logs

[Install]
WantedBy=multi-user.target
